var Configuration=function(b,p){return{abbrevsOn:!0,textBackgrounds:"striped",visual:{margin:{x:2,y:1},arcTextMargin:1,boxSpacing:1,curlyHeight:4,arcSpacing:9,arcStartHeight:19},svgWidth:"100%",rapidModeOn:!1,confirmModeOn:!0,autorefreshOn:!1,typeCollapseLimit:30}}(window),AnnotationLog=function(b,p){return function(b){var q=!1,k=null,n=null;b.on("collectionLoaded",function(b){q=b.annotation_logging}).on("current",function(b,q,p){k=b;n=q}).on("logAction",function(u){if(q)b.post("ajax",[{action:"logAnnotatorAction",
collection:k,document:n,log:u},null]);else return!1})}}(window);
(function(b,p,G){function q(d){return function(){return this[d]}}function k(d,c){var e=2<arguments.length?Array.prototype.slice.call(arguments,2):[];return function(){e.push.apply(e,arguments);return c.apply(d,e)}}function n(d,c){this.K=d;this.c=c}function u(d,c,e){(d=d.K.getElementsByTagName(c)[0])||(d=p.documentElement);return d&&d.lastChild?(d.insertBefore(e,d.lastChild),!0):!1}function Ea(d,c){function e(){p.body?c():setTimeout(e,0)}e()}function A(d,c){return c.parentNode?(c.parentNode.removeChild(c),
!0):!1}function da(d,c){return d.createElement("link",{rel:"stylesheet",href:c})}function Y(d,c){return d.createElement("script",{src:c})}function ca(d,c,e){d=c.className.split(/\s+/);for(var h=0,w=d.length;h<w;h++)if(d[h]==e)return;d.push(e);c.className=d.join(" ").replace(/^\s+/,"")}function N(d,c,e){d=c.className.split(/\s+/);for(var h=[],w=0,b=d.length;w<b;w++)d[w]!=e&&h.push(d[w]);c.className=h.join(" ").replace(/^\s+/,"").replace(/\s+$/,"")}function L(d,c,e){d=c.className.split(/\s+/);c=0;for(var h=
d.length;c<h;c++)if(d[c]==e)return!0;return!1}function D(d,c,e){"MSIE"==d.c.getName()?c.style.cssText=e:c.setAttribute("style",e)}function g(d,c,e,h,w,b,f,m){this.Ba=d;this.Ha=c;this.oa=e;this.na=h;this.Ea=w;this.Da=b;this.ma=f;this.Ia=m}function t(d,c){this.c=d;this.k=c}function S(d){var c=z(d,d.c,/(iPod|iPad|iPhone|Android)/,1);if(""!=c)return c;d=z(d,d.c,/(Linux|Mac_PowerPC|Macintosh|Windows)/,1);return""!=d?("Mac_PowerPC"==d&&(d="Macintosh"),d):"Unknown"}function y(d){var c=z(d,d.c,/(OS X|Windows NT|Android) ([^;)]+)/,
2);return c||(c=z(d,d.c,/(iPhone )?OS ([\d_]+)/,2))?c:(d=z(d,d.c,/Linux ([i\d]+)/,1))?d:"Unknown"}function R(d,c){d=z(d,c,/(\d+)/,1);return""!=d?parseInt(d,10):-1}function z(d,c,e,h){return(d=c.match(e))&&d[h]?d[h]:""}function r(d,c){if(c.documentMode)return c.documentMode}function E(d,c,e,h){this.a=d;this.g=c;this.U=e;this.j=h||Fa;this.h=new pa("-")}function l(d){ca(d.a,d.g,d.h.e(d.j,"loading"));O(d,"loading")}function F(d){N(d.a,d.g,d.h.e(d.j,"loading"));L(d.a,d.g,d.h.e(d.j,"active"))||ca(d.a,d.g,
d.h.e(d.j,"inactive"));O(d,"inactive")}function O(d,c,e,h){d.U[c]&&d.U[c](e,h)}function V(){this.fa={}}function f(d,c){var e=[],h;for(h in c)if(c.hasOwnProperty(h)){var w=d.fa[h];w&&e.push(w(c[h]))}return e}function v(d,c,e,h,w){this.a=d;this.A=c;this.n=e;this.u=h;this.D=w;this.V=0;this.ja=this.ea=!1}function m(d){0==--d.V&&d.ea&&(d.ja?(d=d.A,N(d.a,d.g,d.h.e(d.j,"loading")),N(d.a,d.g,d.h.e(d.j,"inactive")),ca(d.a,d.g,d.h.e(d.j,"active")),O(d,"active")):F(d.A))}function B(d,c,e,h,w,b,f,m,l){this.H=
d;this.$=c;this.a=e;this.n=h;this.u=w;this.D=b;this.Aa=new ka;this.v=new fa;this.L=f;this.B=m;this.sa=l||Ga;this.O=I(this,la);this.P=I(this,qa);this.ca=this.O;this.da=this.P;this.Q=C(this,la);this.R=C(this,qa)}function J(d){d.u(function(c,d){return function(){d.call(c)}}(d,d.J),25)}function Q(d,c){A(d.a,d.Q);A(d.a,d.R);c(d.L,d.B)}function I(d,c){c=C(d,c,!0);var e=d.n.p(c);A(d.a,c);return e}function C(d,c,e){c=d.a.createElement("span",{style:ba(d,c,d.B,e)},d.sa);u(d.a,"body",c);return c}function ba(d,
c,e,h){e=d.v.expand(e);return"position:absolute;top:-999px;left:-999px;font-size:300px;width:auto;height:auto;line-height:normal;margin:0;padding:0;font-variant:normal;font-family:"+(h?"":d.Aa.quote(d.L)+",")+c+";"+e}function ma(d,c,e,h,w){this.a=d;this.X=c;this.g=e;this.u=h;this.c=w;this.M=this.N=0}function Qa(d,c,e){e=f(d.X,e);d.M=d.N=e.length;for(var h=new v(d.a,c,{p:function(c){return c.offsetWidth}},d.u,function(){return(new Date).getTime()}),w=0,b=e.length;w<b;w++){var m=e[w];m.z(d.c,k(d,d.ya,
m,c,h))}}function pa(d){this.za=d||Na}function ka(){this.ha="'"}function fa(){this.G=Ha;this.o=ra}function sa(d,c,e){this.aa=d;this.Fa=c;this.o=e}function ha(d,c){this.a=d;this.d=c}function ta(d,c,e,h,w,b,f,m,l){ta.Ga.call(this,d,c,e,h,w,b,f,m,l);d="Times New Roman;Lucida Sans Unicode;Courier New;Tahoma;Arial;Microsoft Sans Serif;Times;Lucida Console;Sans;Serif;Monospace".split(";");c=d.length;e={};h=C(this,d[0],!0);e[this.n.p(h)]=!0;for(w=1;w<c;w++)b=d[w],D(this.a,h,ba(this,b,this.B,!0)),e[this.n.p(h)]=
!0,"4"!=this.B[1]&&(D(this.a,h,ba(this,b,this.B[0]+"4",!0)),e[this.n.p(h)]=!0);A(this.a,h);this.t=e;this.la=!1}function Ia(d){this.I=d?d:("https:"==b.location.protocol?"https:":"http:")+ua;this.f=[];this.S=[]}function Ja(d){this.f=d;this.ga=[];this.ka={};this.F={};this.v=new fa}function na(d,c,e){this.c=d;this.a=c;this.d=e}function va(d,c){this.a=d;this.d=c}function za(d,c,e){this.m=d;this.a=c;this.d=e;this.f=[];this.s={};this.v=new fa}function P(d,c,e,h,b){this.m=d;this.c=c;this.a=e;this.k=h;this.d=
b;this.f=[];this.s={}}function Aa(d,c,e){this.m=d;this.a=c;this.d=e;this.f=[];this.s={}}n.prototype.createElement=function(d,c,e){d=this.K.createElement(d);if(c)for(var h in c)c.hasOwnProperty(h)&&("style"==h?D(this,d,c[h]):d.setAttribute(h,c[h]));e&&d.appendChild(this.K.createTextNode(e));return d};var ia=g.prototype;ia.getName=q("Ba");ia.xa=q("Ha");ia.Y=q("oa");ia.ua=q("na");ia.va=q("Ea");ia.wa=q("Da");ia.ta=q("ma");ia.w=q("Ia");var Oa=new g("Unknown","Unknown","Unknown","Unknown","Unknown","Unknown",
G,!1);t.prototype.parse=function(){if(-1!=this.c.indexOf("MSIE")){var d=z(this,this.c,/(MSIE [\d\w\.]+)/,1);if(""!=d){var c=d.split(" ");d=c[0];c=c[1];d=new g(d,c,d,c,S(this),y(this),r(this,this.k),6<=R(this,c))}else d=new g("MSIE","Unknown","MSIE","Unknown",S(this),y(this),r(this,this.k),!1)}else if(-1!=this.c.indexOf("Opera")){c=d="Unknown";var e=z(this,this.c,/(Presto\/[\d\w\.]+)/,1);""!=e?(c=e.split("/"),d=c[0],c=c[1]):(-1!=this.c.indexOf("Gecko")&&(d="Gecko"),e=z(this,this.c,/rv:([^\)]+)/,1),
""!=e&&(c=e));-1!=this.c.indexOf("Version/")&&(e=z(this,this.c,/Version\/([\d\.]+)/,1),""!=e)?d=new g("Opera",e,d,c,S(this),y(this),r(this,this.k),10<=R(this,e)):(e=z(this,this.c,/Opera[\/ ]([\d\.]+)/,1),d=""!=e?new g("Opera",e,d,c,S(this),y(this),r(this,this.k),10<=R(this,e)):new g("Opera","Unknown",d,c,S(this),y(this),r(this,this.k),!1))}else if(-1!=this.c.indexOf("AppleWebKit")){d=S(this);c=y(this);e=z(this,this.c,/AppleWebKit\/([\d\.\+]+)/,1);""==e&&(e="Unknown");var h="Unknown";-1!=this.c.indexOf("Chrome")?
h="Chrome":-1!=this.c.indexOf("Safari")?h="Safari":-1!=this.c.indexOf("AdobeAIR")&&(h="AdobeAIR");var b="Unknown";-1!=this.c.indexOf("Version/")?b=z(this,this.c,/Version\/([\d\.\w]+)/,1):"Chrome"==h?b=z(this,this.c,/Chrome\/([\d\.]+)/,1):"AdobeAIR"==h&&(b=z(this,this.c,/AdobeAIR\/([\d\.]+)/,1));if("AdobeAIR"==h){var f=z(this,b,/\d+\.(\d+)/,1);f=2<R(this,b)||2==R(this,b)&&5<=parseInt(f,10)}else f=z(this,e,/\d+\.(\d+)/,1),f=526<=R(this,e)||525<=R(this,e)&&13<=parseInt(f,10);d=new g(h,b,"AppleWebKit",
e,d,c,r(this,this.k),f)}else-1!=this.c.indexOf("Gecko")?(c=d="Unknown",e=!1,-1!=this.c.indexOf("Firefox")?(d="Firefox",h=z(this,this.c,/Firefox\/([\d\w\.]+)/,1),""!=h&&(e=z(this,h,/\d+\.(\d+)/,1),c=h,e=""!=h&&3<=R(this,h)&&5<=parseInt(e,10))):-1!=this.c.indexOf("Mozilla")&&(d="Mozilla"),h=z(this,this.c,/rv:([^\)]+)/,1),""==h?h="Unknown":e||(e=R(this,h),b=parseInt(z(this,h,/\d+\.(\d+)/,1),10),f=parseInt(z(this,h,/\d+\.\d+\.(\d+)/,1),10),e=1<e||1==e&&9<b||1==e&&9==b&&2<=f||null!=h.match(/1\.9\.1b[123]/)||
null!=h.match(/1\.9\.1\.[\d\.]+/)),d=new g(d,c,"Gecko",h,S(this),y(this),r(this,this.k),e)):d=Oa;return d};var Fa="wf";v.prototype.watch=function(d,c,e,h,b){for(var f=d.length,w=0;w<f;w++){var m=d[w];c[m]||(c[m]=["n4"]);this.V+=c[m].length}b&&(this.ea=b);for(w=0;w<f;w++){m=d[w];b=c[m];for(var l=e[m],g=0,r=b.length;g<r;g++){var v=b[g],n=this.A,t=m;ca(n.a,n.g,n.h.e(n.j,t,v,"loading"));O(n,"fontloading",t,v);n=k(this,this.qa);t=k(this,this.ra);(new h(n,t,this.a,this.n,this.u,this.D,m,v,l)).start()}}};
v.prototype.qa=function(d,c){var e=this.A;N(e.a,e.g,e.h.e(e.j,d,c,"loading"));N(e.a,e.g,e.h.e(e.j,d,c,"inactive"));ca(e.a,e.g,e.h.e(e.j,d,c,"active"));O(e,"fontactive",d,c);this.ja=!0;m(this)};v.prototype.ra=function(d,c){var e=this.A;N(e.a,e.g,e.h.e(e.j,d,c,"loading"));L(e.a,e.g,e.h.e(e.j,d,c,"active"))||ca(e.a,e.g,e.h.e(e.j,d,c,"inactive"));O(e,"fontinactive",d,c);m(this)};var la="arial,'URW Gothic L',sans-serif",qa="Georgia,'Century Schoolbook L',serif",Ga="BESbswy";B.prototype.start=function(){this.ia=
this.D();this.J()};B.prototype.J=function(){var d=this.n.p(this.Q),c=this.n.p(this.R);this.O==d&&this.P==c||this.ca!=d||this.da!=c?5E3<=this.D()-this.ia?Q(this,this.$):(this.ca=d,this.da=c,J(this)):Q(this,this.H)};ma.prototype.q=function(d,c){this.X.fa[d]=c};ma.prototype.load=function(d){var c=new E(this.a,this.g,d);this.c.w()?Qa(this,c,d):F(c)};ma.prototype.ya=function(d,c,e,h){var b=d.Z?d.Z():B;h?d.load(k(this,this.Ca,c,e,b)):(d=0==--this.N,this.M--,d&&(0==this.M?F(c):l(c)),e.watch([],{},{},b,d))};
ma.prototype.Ca=function(d,c,e,h,b,f){var w=0==--this.N;w&&l(d);this.u(k(this,function(c,d,e,h,b,f){c.watch(d,e||{},h||{},b,f)},c,h,b,f,e,w))};var Na="-";pa.prototype.e=function(){for(var d=[],c=0;c<arguments.length;c++)d.push(arguments[c].replace(/[\W_]+/g,"").toLowerCase());return d.join(this.za)};ka.prototype.quote=function(d){var c=[];d=d.split(/,\s*/);for(var e=0;e<d.length;e++){var h=d[e].replace(/['"]/g,"");-1==h.indexOf(" ")?c.push(h):c.push(this.ha+h+this.ha)}return c.join(",")};var Ha=["font-style",
"font-weight"],ra={"font-style":[["n","normal"],["i","italic"],["o","oblique"]],"font-weight":[["1","100"],["2","200"],["3","300"],["4","400"],["5","500"],["6","600"],["7","700"],["8","800"],["9","900"],["4","normal"],["7","bold"]]};sa.prototype.compact=function(d,c){for(var e=0;e<this.o.length;e++)if(c==this.o[e][1]){d[this.aa]=this.o[e][0];break}};sa.prototype.expand=function(d,c){for(var e=0;e<this.o.length;e++)if(c==this.o[e][0]){d[this.aa]=this.Fa+":"+this.o[e][1];break}};fa.prototype.compact=
function(d){var c=["n","4"];d=d.split(";");for(var e=0,h=d.length;e<h;e++){var b=d[e].replace(/\s+/g,"").split(":");if(2==b.length){var f=b[1];a:{b=b[0];for(var m=0;m<this.G.length;m++)if(b==this.G[m]){b=new sa(m,b,this.o[b]);break a}b=null}b&&b.compact(c,f)}}return c.join("")};fa.prototype.expand=function(d){if(2!=d.length)return null;for(var c=[null,null],e=0,h=this.G.length;e<h;e++){var b=this.G[e],f=d.substr(e,1);(new sa(e,b,this.o[b])).expand(c,f)}return c[0]&&c[1]?c.join(";")+";":null};b.WebFont=
function(){var d=(new t(navigator.userAgent,p)).parse();return new ma(new n(p,d),new V,p.documentElement,function(c,d){setTimeout(c,d)},d)}();b.WebFont.load=b.WebFont.load;b.WebFont.addModule=b.WebFont.q;g.prototype.getName=g.prototype.getName;g.prototype.getVersion=g.prototype.xa;g.prototype.getEngine=g.prototype.Y;g.prototype.getEngineVersion=g.prototype.ua;g.prototype.getPlatform=g.prototype.va;g.prototype.getPlatformVersion=g.prototype.wa;g.prototype.getDocumentMode=g.prototype.ta;g.prototype.isSupportingWebFont=
g.prototype.w;var wa={regular:"n4",bold:"n7",italic:"i4",bolditalic:"i7",r:"n4",b:"n7",i:"i4",bi:"i7"};ha.prototype.z=function(d,c){return c(d.w())};ha.prototype.load=function(d){u(this.a,"head",da(this.a,("https:"==p.location.protocol?"https:":"http:")+"//webfonts.fontslive.com/css/"+this.d.key+".css"));for(var c=this.d.families,e=[],h={},b=0,f=c.length;b<f;b++){var m=c[b].split(":"),l=m[0];if(m[1]){var g=m[1];m=g.split(",");g=[];for(var v=0,r=m.length;v<r;v++){var n=m[v];if(n){var t=wa[n];g.push(t?
t:n)}}m=g}else m=["n4"];l={W:l,T:m};e.push(l.W);h[l.W]=l.T}c={pa:e,T:h};d(c.pa,c.T)};b.WebFont.q("ascender",function(d){var c=(new t(navigator.userAgent,p)).parse();return new ha(new n(p,c),d)});(function(d,c){function e(){}e.prototype=d.prototype;c.prototype=new e;c.Ga=d;c.Ja=d.prototype})(B,ta);var Ka={Arimo:!0,Cousine:!0,Tinos:!0};ta.prototype.J=function(){var d=this.n.p(this.Q),c=this.n.p(this.R);!this.la&&d==c&&this.t[d]&&(this.t={},this.la=this.t[d]=!0);this.O==d&&this.P==c||this.t[d]||this.t[c]?
5E3<=this.D()-this.ia?this.t[d]&&this.t[c]&&Ka[this.L]?Q(this,this.H):Q(this,this.$):J(this):Q(this,this.H)};var ua="//fonts.googleapis.com/css";Ia.prototype.e=function(){if(0==this.f.length)throw Error("No fonts to load !");if(-1!=this.I.indexOf("kit="))return this.I;for(var d=this.f.length,c=[],e=0;e<d;e++)c.push(this.f[e].replace(/ /g,"+"));d=this.I+"?family="+c.join("%7C");0<this.S.length&&(d+="&subset="+this.S.join(","));return d};var Ca={ultralight:"n2",light:"n3",regular:"n4",bold:"n7",italic:"i4",
bolditalic:"i7",ul:"n2",l:"n3",r:"n4",b:"n7",i:"i4",bi:"i7"},La={latin:Ga,cyrillic:"&#1081;&#1103;&#1046;",greek:"&#945;&#946;&#931;",khmer:"&#x1780;&#x1781;&#x1782;",Hanuman:"&#x1780;&#x1781;&#x1782;"};Ja.prototype.parse=function(){for(var d=this.f.length,c=0;c<d;c++){var e=this.f[c].split(":"),h=e[0],b=["n4"];if(2<=e.length){var f=e[1],m=[];if(f){f=f.split(",");for(var l=f.length,g=0;g<l;g++){var v=f[g];if(v.match(/^[\w ]+$/)){var r=Ca[v];r?v=r:(r=v.match(/^(\d*)(\w*)$/),v=r[1],r=r[2],v=(v=this.v.expand([r?
r:"n",v?v.substr(0,1):"4"].join("")))?this.v.compact(v):null)}else v="";v&&m.push(v)}}0<m.length&&(b=m);3==e.length&&(e=e[2],m=[],e=e?e.split(","):m,0<e.length&&(e=La[e[0]])&&(this.F[h]=e))}!this.F[h]&&(e=La[h])&&(this.F[h]=e);this.ga.push(h);this.ka[h]=b}};na.prototype.z=function(d,c){c(d.w())};na.prototype.Z=function(){return"AppleWebKit"==this.c.Y()?ta:B};na.prototype.load=function(d){var c=this.a;"MSIE"==this.c.getName()&&1!=this.d.blocking?Ea(c,k(this,this.ba,d)):this.ba(d)};na.prototype.ba=
function(d){for(var c=this.a,e=new Ia(this.d.api),h=this.d.families,b=h.length,f=0;f<b;f++){var m=h[f].split(":");3==m.length&&e.S.push(m.pop());e.f.push(m.join(":"))}h=new Ja(h);h.parse();u(c,"head",da(c,e.e()));d(h.ga,h.ka,h.F)};b.WebFont.q("google",function(d){var c=(new t(navigator.userAgent,p)).parse();return new na(c,new n(p,c),d)});va.prototype.load=function(d){for(var c=this.d.urls||[],e=this.d.families||[],h=0,b=c.length;h<b;h++)u(this.a,"head",da(this.a,c[h]));d(e)};va.prototype.z=function(d,
c){return c(d.w())};b.WebFont.q("custom",function(d){var c=(new t(navigator.userAgent,p)).parse();return new va(new n(p,c),d)});za.prototype.C=function(d){return("https:"==this.m.location.protocol?"https:":"http:")+(this.d.api||"//f.fontdeck.com/s/css/js/")+this.m.document.location.hostname+"/"+d+".js"};za.prototype.z=function(d,c){d=this.d.id;var e=this;d?(this.m.__webfontfontdeckmodule__||(this.m.__webfontfontdeckmodule__={}),this.m.__webfontfontdeckmodule__[d]=function(d,b){for(var h=0,f=b.fonts.length;h<
f;++h){var m=b.fonts[h];e.f.push(m.name);e.s[m.name]=[e.v.compact("font-weight:"+m.weight+";font-style:"+m.style)]}c(d)},u(this.a,"head",Y(this.a,this.C(d)))):c(!0)};za.prototype.load=function(d){d(this.f,this.s)};b.WebFont.q("fontdeck",function(d){var c=(new t(navigator.userAgent,p)).parse();return new za(b,new n(p,c),d)});P.prototype.z=function(d,c){var e=this,h=e.d.projectId;if(h){var b=Y(e.a,e.C(h));b.id="__MonotypeAPIScript__"+h;b.onreadystatechange=function(c){if("loaded"===b.readyState||"complete"===
b.readyState)b.onreadystatechange=null,b.onload(c)};b.onload=function(){if(e.m["__mti_fntLst"+h]){var b=e.m["__mti_fntLst"+h]();if(b&&b.length){var f;for(f=0;f<b.length;f++)e.f.push(b[f].fontfamily)}}c(d.w())};u(this.a,"head",b)}else c(!0)};P.prototype.C=function(d){var c=this.protocol(),e=(this.d.api||"fast.fonts.com/jsapi").replace(/^.*http(s?):(\/\/)?/,"");return c+"//"+e+"/"+d+".js"};P.prototype.load=function(d){d(this.f,this.s)};P.prototype.protocol=function(){var d=["http:","https:"],c=d[0];
if(this.k&&this.k.location&&this.k.location.protocol){var e;for(e=0;e<d.length;e++)if(this.k.location.protocol===d[e])return this.k.location.protocol}return c};b.WebFont.q("monotype",function(d){var c=(new t(navigator.userAgent,p)).parse();return new P(b,c,new n(p,c),p,d)});Aa.prototype.C=function(d){var c="https:"==b.location.protocol?"https:":"http:";return(this.d.api||c+"//use.typekit.com")+"/"+d+".js"};Aa.prototype.z=function(d,c){var e=this.d.id,b=this.d,f=this;e?(this.m.__webfonttypekitmodule__||
(this.m.__webfonttypekitmodule__={}),this.m.__webfonttypekitmodule__[e]=function(e){e(d,b,function(d,e,b){f.f=e;f.s=b;c(d)})},u(this.a,"head",Y(this.a,this.C(e)))):c(!0)};Aa.prototype.load=function(d){d(this.f,this.s)};b.WebFont.q("typekit",function(d){var c=(new t(navigator.userAgent,p)).parse();return new Aa(b,new n(p,c),d)});b.WebFontConfig&&b.WebFont.load(b.WebFontConfig)})(this,document);
var Dispatcher=function(b,p,G){var q=function(){var k=this,n={},u=!1,p=function(b){u?console.warn("Dropped asynch error:",b):(u=!0,console.warn("Handled async error:",b),k.post("dispatchAsynchError",[b]),u=!1)},A={on:function L(b,k,u){u===G&&(u=k,k=L.caller);n[b]===G&&(n[b]=[]);n[b].push([k,u]);return this},post:function g(k,u,q,D){"number"!==typeof k&&(D=q,q=u,u=k,k=null);q===G&&(q=[]);var t=[];if("function"===typeof u){var S=g.caller;result=null!==k?setTimeout(function(){try{u.apply(S,q)}catch(R){p(R)}},
k):u.apply(S,q);t.push(result)}else{var y=n[u];y!==G&&b.each(y,function(b,g){var r=null!==k?setTimeout(function(){try{g[1].apply(g[0],q)}catch(E){p(E)}},k):g[1].apply(g[0],q);t.push(r)})}if("any"==D){for(D=t.length;D--;)if(!1!==t[D])return t[D];return!1}if("all"==D)for(D=t.length;D--;)if(!1===t[D])return t[D];return t},proxy:function(b,n){this.on(n,function(){b.post(n,Array.prototype.slice.call(arguments))})}};q.dispatchers.push(A);return A};q.dispatchers=[];q.post=function(k,n,u,p){b.each(q.dispatchers,
function(b,q){q.post(k,n,u,p)})};return q}(jQuery,window),URLMonitor=function(b,p,G){return function(q){var k=this,n=!0,u=!1,G={};k.url_hash=new URLHash;var A=function(L,D){var g=k.url_hash.arguments,t=URLHash.splitArgs(L);Util.isEqual(k.url_hash.extArguments,t[1])||(u=!0,k.url_hash.setArguments(L),q.post("argsChanged",[L,g]));if(u)G=t[0],g=k.url_hash.getHash(),u=!1,p.location.hash=g,g=b('link[type="image/x-icon"]').remove().attr("href"),b('<link href="'+g+'" rel="shortcut icon" type="image/x-icon" />').appendTo("head"),
q.post("hideForm");else if(D||!Util.isEqual(k.url_hash.intArguments,t[0]))k.url_hash.setArguments(L),q.post("hideForm"),q.post("argsChanged",[L,g]),q.post("current",[k.url_hash.collection,k.url_hash.document,k.url_hash.arguments,n]),n=!0},da=function(b,n){var g=k.url_hash.document;g!==b&&(u=!0,k.url_hash.setDocument(b),q.post("docChanged",[b,g]));A(n||null)},Y=function(n,p,g){var t=k.url_hash.collection;t!==n&&(u=!0,k.url_hash.setCollection(n),b("#waiter").dialog("open"),q.post("ajax",[{action:"getCollectionInformation",
collection:n},"collectionLoaded",{collection:n,keep:!0}]),q.post("collectionChanged",[n,t]));da(p||"",g)},ca=function(){q.post("makeAjaxObsolete");if(!u){var A=URLHash.parse(p.location.hash);Y(A.collection,A.document,b.extend(A.arguments,G));k.url_hash=A;G={}}q.post("current",[k.url_hash.collection,k.url_hash.document,k.url_hash.arguments,n]);n=!0},N=function(){b(p).trigger("hashchange")};q.on("forceUpdate",N).on("setArguments",A).on("setDocument",da).on("setCollection",Y).on("preventReloadByURL",
function(){n=!1}).on("allowReloadByURL",function(){n=!0}).on("init",function(){b(p).bind("hashchange",ca);N()})}}(jQuery,window),URLHash=function(b,p,G){var q=function(b,k,q){this.collection=b;this.document=k||"";this.arguments=q||{};this.calcArgs()};q.prototype={calcArgs:function(){var b=q.splitArgs(this.arguments);this.intArguments=b[0];this.extArguments=b[1]},setArgument:function(b,k){this.arguments||(this.arguments={});this.arguments[b]=k;this.calcArgs();return this},setArguments:function(n){this.arguments=
b.extend({},n||{});this.calcArgs();return this},setDocument:function(b){this.document=b;return this},setCollection:function(b){this.collection=b;return this},getHash:function(){var b=this.collection+this.document,k=Util.param(this.extArguments);k.length&&(b+="?"+k);b.length&&(b="#"+b);return b}};var k=["match","matchfocus","edited"];q.splitArgs=function(n){var q={};n=b.extend({},n);for(var p=k.length,G=0;G<p;G++)q[k[G]]=n[k[G]],delete n[k[G]];return[q,n]};q.parse=function(b){b.length&&(b=b.substr(1));
b=b.split("?");var n=b[0]||"",k=b[1]||"",p=n.lastIndexOf("/");-1===p?b="/":(b=n.substr(0,p+1),"/"!==b[b.length-1]&&(b+="/"),"/"!==b[0]&&(b="/"+b));n=n.substr(p+1);k=Util.deparam(k);return new q(b,n,k)};return q}(jQuery,window),Visualizer=function(b,p,G){var q=function(b){this.text=b;this.chunks=[];this.spans={};this.eventDescs={};this.sentComment={};this.arcs=[];this.arcById={};this.markedSent={};this.spanAnnTexts={};this.towers={}},k=function(b,t,n,k){this.id=b;this.span=t;this.from=n;this.to=k},
n=function(b,t,n,k){this.id=b;this.type=t;this.numArcs=this.totalDist=0;this.generalType=k;this.headFragment=null;this.unsegmentedOffsets=n;this.offsets=[];this.segmentedOffsetsMap={};this.initContainers()};n.prototype.initContainers=function(b){this.incoming=[];this.outgoing=[];this.attributes={};this.attributeText=[];this.attributeCues={};this.attributeCueFor={};this.attributeMerge={};this.fragments=[];this.normalizations=[]};n.prototype.splitMultilineOffsets=function(b){this.segmentedOffsetsMap=
{};for(var g=0,n=0;g<this.unsegmentedOffsets.length;g++){for(var k=this.unsegmentedOffsets[g][0],q=this.unsegmentedOffsets[g][1],p=k;p<q;p++){var r=b.charAt(p);"\n"==r||"\r"==r?null!==k&&(this.offsets.push([k,p]),this.segmentedOffsetsMap[n++]=g,k=null):null===k&&(k=p)}null!==k&&(this.offsets.push([k,q]),this.segmentedOffsetsMap[n++]=g)}};n.prototype.copy=function(g){var k=b.extend(new n,this);k.id=g;k.initContainers();k.unsegmentedOffsets=this.unsegmentedOffsets.slice();k.offsets=this.offsets;k.segmentedOffsetsMap=
this.segmentedOffsetsMap;return k};var u=function(g,k,n,q){this.id=g;this.triggerId=k;var t=this.roles=[];b.each(n,function(b,g){t.push({type:g[0],targetId:g[1]})});"equiv"==q?this.equiv=!0:"relation"==q&&(this.relation=!0)},Ea=function(b,k,n,q,p,u){this.index=b;this.text=k;this.from=n;this.to=q;this.space=p;this.fragments=[]},A=function(b,k,n,q){this.origin=b.id;this.target=k.targetId;this.dist=n;this.type=k.type;this.shadowClass=b.shadowClass;this.jumpHeight=0;b.equiv?(this.equiv=!0,this.eventDescId=
q,b.equivArc=this):b.relation&&(this.relation=!0,this.eventDescId=q)},da=function(b){this.group=b.group();this.background=b.group(this.group);this.chunks=[];this.hasAnnotations=!1;this.maxSpanHeight=this.maxArcHeight=0},Y=function(b,k,n){this.widths=b;this.height=k;this.y=n},ca=function(b){for(var g=[],k=null,n=null,q=0;q<b.length;q++){var p=b[q];null!=k||/\s/.test(p)?/\s/.test(p)&&null!=k?(g.push([k,q]),k=null):/\s/.test(p)||(n=q):n=k=q}null!=k&&g.push([k,n+1]);return g},N=function(b){for(var g=
[],k=null,n=null,q=0;q<b.length;q++){var p=b[q];null!=k||/\s/.test(p)?"\n"==p&&null!=k?(g.push([k,q]),k=null):/\s/.test(p)||(n=q):n=k=q}null!=k&&g.push([k,n+1]);return g},L=function(g){b.each("attributes comments entities equivs events modifications normalizations relations triggers".split(" "),function(b,k){g[k]===G&&(g[k]=[])});g.sentence_offsets===G&&(g.sentence_offsets=N(g.text));g.token_offsets===G&&(g.token_offsets=ca(g.text))},D=function(g){b.each("entity_attribute_types entity_types event_attribute_types event_types relation_attribute_types relation_types unconfigured_types".split(" "),
function(b,k){g[k]===G&&(g[k]=[])})};return function(g,t,N){var y=b("#"+t);if(!y.length)throw Error('Could not find container with id="'+t+'"');var R=this,z={" ":4,"\u00a0":4,"\u200b":0,"\u3000":8,"\t":12,"\n":4},r,E,l=null,F=null,O=null,V,f,v,m,B,J=!1,Q=null,I=null,C=null,ba,ca=!1,S=!1,pa="Unconfirmed Incomplete Warning Error AnnotatorNotes AddedAnnotation MissingAnnotation ChangedAnnotation".split(" ");this.arcDragOrigin=null;var ka=function(){E.css("margin-bottom",1);setTimeout(function(){E.css("margin-bottom",
0)},0)},fa=function(c){var d=b.extend({},c.rectBox);c=c.chunk.translation;d.x+=c.x;d.y+=c.y;return d},sa=function(c){if(c===G)return-1;for(var d=pa.length,b=0;b<d;b++)if(-1!=c.indexOf(pa[b]))return b;return 0},ha=function(c){b.each(v[c]||[],function(d,h){if("sent"==h[0])l.markedSent[h[1]]=!0;else if("equiv"==h[0])b.each(F.equivs,function(d,b){if(b[1]==h[1])for(var e=b.length,f=2;f<e;f++)if(b[f]==h[2]){e-=3;for(f=1;f<=e;f++)l.eventDescs[b[0]+"*"+f].equivArc.marked=c;break}});else if(2==h.length)markedText.push([parseInt(h[0],
10),parseInt(h[1],10),c]);else{var e=l.spans[h[0]];if(e)3==h.length?b.each(e.outgoing,function(d,b){b.target==h[2]&&b.type==h[1]&&(b.marked=c)}):e.marked=c;else if(e=l.eventDescs[h[0]]){var f=e.roles[0];b.each(l.spans[e.triggerId].outgoing,function(d,b){b.target==f.targetId&&b.type==f.type&&(b.marked=c)})}else b.each(l.eventDescs,function(d,b){b.triggerId==h[0]&&(l.spans[b.id].marked=c)})}})},ta=function(c,d,b){for(var e=0;c<=d;c++)b[c]>e&&(e=b[c]);return e+Configuration.visual.arcSpacing},Ia=function(c,
d,b,f){for(;c<=d;c++)b[c]<f&&(b[c]=f)},Ja=function(c,d){var b,e=c.span,f=d.span;if(b=e.fragments.length-f.fragments.length)return 0>b?1:-1;if((b=e.avgDist-f.avgDist)||(b=e.numArcs-f.numArcs))return 0>b?-1:1;b=c.to-c.from-(d.to-d.from);0==e.numArcs&&0==f.numArcs&&(b=-b);return b?0>b?1:-1:(b=e.refedIndexSum-f.refedIndexSum)?0>b?-1:1:e.type<f.type?-1:e.type>f.type?1:0},na=function(c){v||(v={});F=c;g.post("newSourceData",[F]);l=new q(F.text);b.each(F.entities,function(c,d){var b=new n(d[0],d[1],d[2],
"entity");b.splitMultilineOffsets(l.text);l.spans[d[0]]=b});var d={};b.each(F.triggers,function(c,b){var e=new n(b[0],b[1],b[2],"trigger");e.splitMultilineOffsets(l.text);d[b[0]]=[e,[]]});b.each(F.events,function(c,b){var e=l.eventDescs[b[0]]=new u(b[0],b[1],b[2]),f=d[e.triggerId],h=f[0].copy(e.id);f[1].push(h);l.spans[e.id]=h});b.each(F.modifications,function(c,d){l.spans[d[2]]?l.spans[d[2]][d[1]]=!0:g.post("messages",[[["<strong>ERROR</strong><br/>Event "+d[2]+" (referenced from modification "+
d[0]+") does not occur in document "+l.document+"<br/>(please correct the source data)","error",5]]])});var f=function(d,c){var b=d.from+d.to-c.from-c.to;return b?0>b?-1:1:0};b.each(l.spans,function(d,c){b.each(c.offsets,function(d,b){var e=parseInt(b[0],10),f=parseInt(b[1],10);e=new k(d,c,e,f);c.fragments.push(e)});c.fragments.sort(f);c.wholeFrom=c.fragments[0].from;c.wholeTo=c.fragments[c.fragments.length-1].to;c.headFragment=c.fragments[c.fragments.length-1]});var w=function(c,d){var b=l.spans[c],
e=l.spans[d];return(b=b.headFragment.from+b.headFragment.to-e.headFragment.from-e.headFragment.to)?0>b?-1:1:0};b.each(F.equivs,function(c,d){d[0]="*"+c;var e=d.slice(2),f=[];b.each(e,function(c,d){l.spans[d]&&f.push(d)});f.sort(w);e=f.length;for(var h=1;h<e;h++){var m=l.eventDescs[d[0]+"*"+h]=new u(f[h-1],f[h-1],[[d[1],f[h]]],"equiv");m.leftSpans=f.slice(0,h);m.rightSpans=f.slice(h)}});b.each(F.relations,function(c,d){var b=m[d[1]];if(b=b&&b.args){var e={};e[d[2][0][0]]=d[2][0][1];e[d[2][1][0]]=d[2][1][1];
var f=e[b[0].role];b=e[b[1].role]}else f=d[2][0][1],b=d[2][1][1];l.eventDescs[d[0]]=new u(f,f,[[d[1],b]],"relation")});b.each(F.attributes,function(d,c){var e=I[c[1]]||Q[c[1]],f=e&&e.values[e.bool||c[3]],h=l.spans[c[2]];if(h){var m=f&&f.name||c[3];h.attributeText.push(e?e.bool?e.name:e.name+": "+m:1==c[3]?c[1]:c[1]+": "+c[3]);h.attributes[c[1]]=c[3];c[4]&&(h.attributeCues[c[1]]=c[4],e=l.spans[c[4]],e.attributeCueFor[l.spans[1]]=c[2],e.cue="CUE");b.extend(h.attributeMerge,f)}else g.post("messages",
[[["Annotation "+c[2]+", referenced from attribute "+c[0]+", does not exist.","error"]]])});b.each(F.comments,function(c,e){if(e[0]instanceof Array&&"sent"==e[0][0]){var f=e[0][1],h=e[2];l.sentComment[f]&&(h=l.sentComment[f].text+"<br/>"+h);l.sentComment[f]={type:e[1],text:h}}else f=e[0],h=d[f],b.each(h?h[1]:f in l.spans?[l.spans[f]]:f in l.eventDescs?[l.eventDescs[f]]:[],function(c,d){d.comment?(d.comment.type=e[1],d.comment.text+="\n"+e[2]):d.comment={type:e[1],text:e[2]};"AnnotatorNotes"==e[1]&&
(d.annotatorNotes=e[2]);sa(e[1])>sa(d.shadowClass)&&(d.shadowClass=e[1])})});b.each(F.normalizations,function(c,d){var b=d[0],e=d[2],f=d[3],h=d[4],m=d[5],k=l.spans[e];k?(k.normalizations.push([f,h,m]),k.normalized="Normalized"):g.post("messages",[[["Annotation "+e+", referenced from normalization "+b+", does not exist.","error"]]])});var B=[];b.each(l.spans,function(d,c){b.each(c.fragments,function(d,c){B.push(c)})});B.sort(function(c,d){var b=c.from,e=d.from;b==e&&(b=c.to,e=d.to);return b<e?-1:b>
e?1:0});var p=0,ya=0,t=B.length,J=0,Ba=null,z=0,y,x=null;b.each(F.token_offsets,function(){var c=this[0],d=this[1];null===Ba&&(Ba=c);if(ya&&d>B[ya-1].to)for(;ya<t&&d>B[ya].from;)ya++;for(p=ya;p<t&&d>=B[p].to;)p++;p<t&&d>B[p].from||(y=l.text.substring(J,Ba),c=l.text.substring(Ba,d),x&&(x.nextSpace=y),x=new Ea(z++,c,Ba,d,y),x.lastSpace=y,l.chunks.push(x),J=d,Ba=null)});var D=z,E=z=0,R=!1;b.each(F.sentence_offsets,function(){var d=this[0];if(z>=D)return!1;if(!(l.chunks[z].from>d)){for(var c;z<D&&(c=
l.chunks[z]).from<d;)z++;z++;R&&d<=c.from?((d=c.space.split("\n").length-1)||(d=1),E+=d,c.sentence=E):R=!0}});var ba=0;b.each(B,function(d,c){for(;c.to>(x=l.chunks[ba]).to;)ba++;x.fragments.push(c);c.text=x.text.substring(c.from-x.from,c.to-x.from);c.chunk=x});b.each(l.eventDescs,function(c,d){var e=l.spans[d.id];if(e){var f=e.headFragment.from+e.headFragment.to;b.each(d.roles,function(b,h){var m=l.spans[h.targetId];if(m){var k=Math.abs(f-(m.headFragment.from+m.headFragment.to)),v=new A(d,h,k,c);
e.totalDist+=k;e.numArcs++;m.totalDist+=k;m.numArcs++;l.arcs.push(v);m.incoming.push(v);e.outgoing.push(v);l.arcById[e.id+"--"+h.type+"--"+m.id]=v}else g.post("messages",[[['<strong>ERROR</strong><br/>"'+h.targetId+'" (referenced from "'+d.id+'") not found in '+l.document+"<br/>(please correct the source data)","error",5]]])})}else g.post("messages",[[['<strong>ERROR</strong><br/>Trigger for event "'+d.id+'" not found in '+l.document+"<br/>(please correct the source data)","error",5]]])});markedText=
[];ha("edited");ha("focus");ha("matchfocus");ha("match");b.each(l.spans,function(d,c){c.avgDist=c.numArcs?c.totalDist/c.numArcs:0;lastSpan=c;var e=[];b.each(c.fragments,function(c,d){e.push(d.text)});c.text=e.join("")});for(c=0;2>c;c++)b.each(l.chunks,function(c,d){d.fragments.sort(Ja);b.each(d.fragments,function(c,d){d.indexNumber=c})}),b.each(l.spans,function(c,d){d.refedIndexSum=0}),b.each(l.arcs,function(d,c){l.spans[c.origin].refedIndexSum+=l.spans[c.target].headFragment.indexNumber});b.each(l.chunks,
function(c,d){d.fragments.sort(Ja);b.each(d.fragments,function(c,d){d.drawOrder=c})});l.spanDrawOrderPermutation=Object.keys(l.spans);l.spanDrawOrderPermutation.sort(function(c,d){var b=l.spans[c].headFragment.drawOrder-l.spans[d].headFragment.drawOrder;return b?0>b?-1:1:0});B.sort(f);var H=null,ja=-1;b.each(B,function(c,d){H&&H.from==d.from&&H.to==d.to||ja++;d.towerId=ja;H=d});b.each(l.spanDrawOrderPermutation,function(d,c){b.each(l.spans[c].fragments,function(d,c){l.towers[c.towerId]||(l.towers[c.towerId]=
[],c.drawCurly=!0,c.span.drawCurly=!0);l.towers[c.towerId].push(c)})});var Z={};b.each(l.chunks,function(c,d){d.markedTextStart=[];d.markedTextEnd=[];b.each(d.fragments,function(c,e){d.firstFragmentIndex==G&&(d.firstFragmentIndex=e.towerId);d.lastFragmentIndex=e.towerId;var f=Util.getSpanLabels(C,e.span.type);e.labelText=Util.spanDisplayForm(C,e.span.type);if(Configuration.abbrevsOn&&f)for(var h=1,m=(e.to-e.from)/.8;e.labelText.length>m&&f[h];)e.labelText=f[h],h++;var g=r.createText(),k=[],W="",v=
"",n=!1;b.each(e.span.attributes,function(d,c){var e=I[d]||Q[d];if(e){var f=e.values[e.bool||c];f?b.isEmptyObject(f)?n=!0:f.glyph&&("left"==f.position?(W=f.glyph+W,e={"class":"glyph"},f.glyphColor&&(e.fill=f.glyphColor),g.span(f.glyph,e)):(k.push([e,f]),v+=f.glyph)):n=!0}else n=!0});f=e.labelText;""!==W&&(f=W+" "+f,g.string(" "));g.string(e.labelText);k.length&&(f+=" "+v,g.string(" "),b.each(k,function(d,c){var b={"class":"glyph"};c[1].glyphColor&&(b.fill=c[1].glyphColor);g.span(c[1].glyph,b)}));
n&&(g.span("#",{"class":"glyph attribute_warning"}),f+=" #");e.glyphedLabelText=f;Z[f]||(Z[f]=!0,l.spanAnnTexts[f]=g)})});D=l.chunks.length;var S=0,O;markedText.sort(function(c,d){return Util.cmp(c[0],d[0])});b.each(markedText,function(c,d){var b=d[0],e=d[1],f=d[2];0>b&&(b=0);0>e&&(e=0);e>=l.text.length&&(e=l.text.length-1);for(b>e&&(b=e);S<D;){var h=l.chunks[S];if(b<=h.to){h.markedTextStart.push([c,!0,b-h.from,null,f]);break}S++}if(S==D)g.post("messages",[[["Wrong text offset","error"]]]);else{for(O=
S;O<D;){h=l.chunks[O];if(e<=h.to){h.markedTextEnd.push([c,!1,e-h.from]);break}O++}O==D&&(g.post("messages",[[["Wrong text offset","error"]]]),h=l.chunks[l.chunks.length-1],h.markedTextEnd.push([c,!1,h.text.length]))}});g.post("dataReady",[l])},va=function(c,d,f){b(c.group).attr("transform","translate("+d+", "+f+")");c.translation={x:d,y:f}},za=function(){var d=(V+"/"+f).replace("--","-\\-");E.append("\x3c!-- document: "+d+" --\x3e");d=r.defs();var e=b('<filter id="Gaussian_Blur"><feGaussianBlur in="SourceGraphic" stdDeviation="2" /></filter>');
r.add(d,e);return d},P=function(d,e,f){e=r.group(e);for(var c in d)d.hasOwnProperty(c)&&r.text(e,0,0,c);var h={};b(e).find("text").each(function(c,e){var m=b(e).text();h[m]=this.getComputedTextLength();f&&b.each(d[m],function(d,c){f(c,e)})});c=e.getBBox();r.remove(e);return new Y(h,c.height,c.y)},Aa=function(){var d={};b.each(l.chunks,function(c,b){b.row=G;d.hasOwnProperty(b.text)||(d[b.text]=[]);var e=d[b.text];e.push.apply(e,b.fragments);e.push.apply(e,b.markedTextStart);e.push.apply(e,b.markedTextEnd)});
var e=P(d,G,function(d,c){if(d instanceof k){var b=d.from-d.chunk.from;0>b&&(b=0,g.post("messages",[[["<strong>WARNING</strong><br/> The fragment ["+d.from+", "+d.to+"] ("+d.text+") is not contained in its designated chunk ["+d.chunk.from+", "+d.chunk.to+"] most likely due to the fragment starting or ending with a space, please verify the sanity of your data since we are unable to visualise this fragment correctly and will drop leading space characters","warning",15]]]));var e=d.to-d.chunk.from-1,
f=d.chunk.text.substring(0,b),h=d.chunk.text.substring(0,e),m=f.replace(/\s\s+/g," "),l=h.replace(/\s\s+/g," ");b-=f.length-m.length;e-=h.length-l.length;f=b<d.chunk.text.length?c.getStartPositionOfChar(b).x:c.getComputedTextLength();b=e<b?f:c.getEndPositionOfChar(e).x;d.curly={from:f,to:b}}else 0>d[2]&&(d[2]=0),d[3]=d[2]?c.getEndPositionOfChar(d[2]-1).x+1:c.getStartPositionOfChar(d[2]).x}),f={},m=!0;b.each(l.spans,function(d,c){b.each(c.fragments,function(d,c){f[c.glyphedLabelText]=!0;m=!1})});m&&
(f.$=!0);var v=P(f,{"class":"span"});return{texts:e,fragments:v}},ia=function(d){var c={};b.each(l.arcs,function(d,e){var f=Util.getArcLabels(C,l.spans[e.origin].type,e.type,m);f.length||(f=[e.type]);b.each(f,function(d,b){c[b]=!0})});var f=P(c,{"class":"arcs"});d.arcs=f},Oa=function(){b.each(l.towers,function(d,e){var c=0;b.each(e,function(d,b){var e=l.sizes.fragments.widths[b.glyphedLabelText];e>c&&(c=e)});b.each(e,function(d,b){b.width=c})})},Fa=function(d,e){var c=e.split(","),f=c[0];if("none"!=
f){if(b.isNumeric(c[1])&&c[2])if(b.isNumeric(c[2])&&c[3])var m=c[1],l=c[2],g=c[3]||"black";else m=l=c[1],g=c[2]||"black";else m=l=5,g=c[1]||"black";c="arrow_"+e.replace(/#/g,"").replace(/,/g,"_");"triangle"==f&&(f=r.marker(d,c,m,l/2,m,l,"auto",{markerUnits:"strokeWidth",fill:g}),r.polyline(f,[[0,0],[m,l/2],[0,l],[m/12,l/2]]));return c}},la=!1,qa=!1,Ga=function(d){Util.profileEnd("before render");Util.profileStart("render");Util.profileStart("init");if(d||l)if(y.show(),d&&d.collection&&(d.document!==
f||d.collection!==V)||la)qa=!0,g.post("doneRendering",[V,f,v]);else{if(qa=!1,la=!0,d&&na(d),l.mtime?b("#document_mtime").text("Last modified: "+Util.formatTimeAgo(1E3*l.mtime)).css("display","inline"):b("#document_mtime").css("display","none"),r.clear(!0),l&&0!=l.length){canvasWidth=R.forceWidth||y.width();var c=za(),h=r.group({"class":"background"});r.group({"class":"glow"});ba=r.group({"class":"highlight"});var k=r.group({"class":"text"});Util.profileEnd("init");Util.profileStart("measures");var n=
Aa();l.sizes=n;Oa();var q=0,B;for(B in n.texts.widths)n.texts.widths.hasOwnProperty(B)&&(d=n.texts.widths[B],d>q&&(q=d));Util.profileEnd("measures");Util.profileStart("chunks");var p=Configuration.visual.margin.x+20+2,t=[],J=[],u=0,Q=0,x=new da(r);x.sentence=++Q;x.backgroundIndex=u;var D=x.index=0,F={},O=[];ia(n);var I=[],H=[];for(B=0;B<=l.lastFragmentIndex;B++)reservation[B]={};var A=1/0;b.each(l.spanDrawOrderPermutation,function(d,c){var e=l.spans[c],f=C[e.type];if("hidden"==(f&&f.bgColor||C.SPAN_DEFAULT&&
C.SPAN_DEFAULT.bgColor||"#ffffff"))e.hidden=!0;else{f=e.fragments[0];var h=e.fragments[e.fragments.length-1],m=(f.curly.from+f.curly.to-f.width)/2-Configuration.visual.margin.x,W=f.chunk.index,g=(h.curly.from+h.curly.to+h.width)/2+Configuration.visual.margin.x,k=h.chunk.index,v=0;f=e.drawCurly?Configuration.visual.curlyHeight:0;var r=n.fragments.height+f+Configuration.visual.boxSpacing+2*Configuration.visual.margin.y-3;b.each(I,function(d,c){for(var e=!0,f=W;f<=k;f++)if(H[f]&&H[f][c]){var h=f==W?
m:-A,l=f==k?g:A;b.each(H[f][c],function(d,c){if(c[0]<l&&h<c[1])return e=!1})}if(e)if(null===v)v=c;else{if(r+v<=c)return!1}else v=null});var B=H.length,q=function(d){var c=b.inArray(d,I);if(-1==c&&(I.push(d),I.sort(Util.cmp),c=b.inArray(d,I),0!=c))for(var e=I[c-1],f=0;f<=B;f++)if(H[f]){H[f][e]||(H[f][e]=[]);var h=d-e;b.each(H[f][e],function(c,b){b[2]>h&&(H[f][d]||(H[f][d]=[]),H[f][d].push([b[0],b[1],b[2]-h]))})}return c};h=v+r;q(h);var p;for(q=q(v);(p=I[q])!==G&&p<h;q++)for(var w=h-p,J=W;J<=k;J++){var t=
J==W?m:0,u=J==k?g:A;H[J]||(H[J]={});H[J][p]||(H[J][p]=[]);H[J][p].push([t,u,w])}e.floor=v+f}});b.each(l.chunks,function(d,c){var e=0;if(c.lastSpace){var f=c.lastSpace.length||0,h=c.lastSpace.lastIndexOf("\n")+1;if(h||!d||!c.sentence){for(;h<f;h++)e+=z[c.lastSpace[h]]||0;p+=e}}c.group=r.group(x.group);c.highlightGroup=r.group(c.group);var g=0,k,v,W,B,w=Infinity,I=0,y=0,H=0,Z=null,E=0;b.each(c.fragments,function(d,e){var f=e.span,h=C[f.type],q=h&&h.bgColor||C.SPAN_DEFAULT&&C.SPAN_DEFAULT.bgColor||"#ffffff";
if(!f.hidden){var Ma=h&&h.fgColor||C.SPAN_DEFAULT&&C.SPAN_DEFAULT.fgColor||"#000000",Pa=h&&h.borderColor||C.SPAN_DEFAULT&&C.SPAN_DEFAULT.borderColor||"#000000";"darken"==Pa&&(Pa=Util.adjustColorLightness(q,-.6));e.group=r.group(c.group,{"class":"span"});var t=0;g||(g=-n.texts.height);var xa=(e.curly.from+e.curly.to)/2,u=g+n.fragments.y,Da=n.fragments.height,x=e.width;u+=1.5;Da-=3;h=xa-x/2+0;var z="span_"+(f.cue||f.type)+" span_default";f.comment&&f.comment.type&&(z+=" "+f.comment.type);var aa=h-Configuration.visual.margin.x-
0,G=u-Configuration.visual.margin.y;x=x-0+2*Configuration.visual.margin.x;var K=Da+2*Configuration.visual.margin.y;xa=(xa|0)+.5;aa=(aa|0)+.5;if(f.marked){var Q=r.rect(c.highlightGroup,aa-6,G-6,x+12,K+12,{"class":"shadow_EditHighlight",rx:6,ry:6});r.other(Q,"animate",{"data-type":f.marked,attributeName:"fill",values:"match"==f.marked?"#FFFF00":"#FF9632;#FFCC00;#FF9632",dur:"2s",repeatCount:"indefinite",begin:"indefinite"});w=Math.min(aa-6,w);I=Math.max(aa+x+6,I);t=Math.max(K+12,t)}if(f.shadowClass&&
f.shadowClass.match("True_positive|False_positive|False_negative|AnnotationError|AnnotationWarning|AnnotatorNotes|Normalized|AnnotationIncomplete|AnnotationUnconfirmed|rectEditHighlight|EditHighlight_arc|MissingAnnotation|ChangedAnnotation ")){var F=r.rect(e.group,aa-3,G-3,x+6,K+6,{"class":"shadow_"+f.shadowClass,filter:"url(#Gaussian_Blur)",rx:2.5,ry:2.5});w=Math.min(aa-3,w);I=Math.max(aa+x+3,I);t=Math.max(K+6,t)}e.rect=r.rect(e.group,aa,G,x,K,{"class":z,fill:q,stroke:Pa,rx:Configuration.visual.margin.x,
ry:Configuration.visual.margin.y,"data-span-id":f.id,"data-fragment-id":f.segmentedOffsetsMap[e.id],strokeDashArray:f.attributeMerge.dashArray});f.normalized&&b(e.rect).addClass(f.normalized);e.right=aa+x;f.shadowClass||f.marked||(w=Math.min(aa,w),I=Math.max(aa+x,I),t=Math.max(K,t));e.rectBox={x:aa,y:G-f.floor,width:x,height:K};e.height=f.floor+Da+3*Configuration.visual.margin.y+Configuration.visual.curlyHeight+Configuration.visual.arcSpacing;q=2*e.towerId;if(!J[q]||J[q]<e.height)J[q]=e.height;b(e.rect).attr("y",
u-Configuration.visual.margin.y-f.floor);F&&b(F).attr("y",u-3-Configuration.visual.margin.y-f.floor);Q&&b(Q).attr("y",u-6-Configuration.visual.margin.y-f.floor);"crossed"===f.attributeMerge.box&&(r.path(e.group,r.createPath().move(h,u-Configuration.visual.margin.y-f.floor).line(h+e.width,u+Da+Configuration.visual.margin.y-f.floor),{"class":"boxcross"}),r.path(e.group,r.createPath().move(h+e.width,u-Configuration.visual.margin.y-f.floor).line(h,u+Da+Configuration.visual.margin.y-f.floor),{"class":"boxcross"}));
r.text(e.group,xa,g-f.floor,l.spanAnnTexts[e.glyphedLabelText],{fill:Ma});e.drawCurly&&(Ma="grey",q=(h=C[f.type])&&h.bgColor||C.SPAN_DEFAULT&&C.SPAN_DEFAULT.fgColor||"#000000",Ma=Util.adjustColorLightness(q,-.6),u=u+Da+Configuration.visual.margin.y-f.floor+1,r.path(e.group,r.createPath().move(e.curly.from,u+Configuration.visual.curlyHeight).curveC(e.curly.from,u,xa,u+Configuration.visual.curlyHeight,xa,u).curveC(xa,u+Configuration.visual.curlyHeight,e.curly.to,u,e.curly.to,u+Configuration.visual.curlyHeight),
{"class":"curly",stroke:Ma}),w=Math.min(e.curly.from,w),I=Math.max(e.curly.to,I),t=Math.max(Configuration.visual.curlyHeight,t));e==f.headFragment&&(b.each(f.incoming,function(d,e){var b=l.spans[e.origin],f=b.headFragment.chunk;c.index==f.index&&(W=!0);if(f.row){var h=Util.getArcLabels(C,b.type,e.type,m);h.length||(h=[e.type]);b=f.row.index==D?f.translation.x+b.fragments[b.fragments.length-1].right:Configuration.visual.margin.x+20+2;h=n.arcs.widths[h[Configuration.abbrevsOn?h.length-1:0]]+16;b=h-
(p+aa-b);if(!k||H<b)H=b,Z=f.index+1;b=h-aa;if(!k||E<b)E=b;k=!0}else v=!0}),b.each(f.outgoing,function(d,c){var e=l.spans[c.target],b=e.headFragment.chunk;if(b.row){var h=Util.getArcLabels(C,f.type,c.type,m);h.length||(h=[c.type]);e=b.row.index==D?b.translation.x+e.fragments[e.fragments.length-1].right:Configuration.visual.margin.x+20+2;h=n.arcs.widths[h[Configuration.abbrevsOn?h.length-1:0]]+16;e=h-(p+aa-e);if(!k||H<e)H=e,Z=b.index+1;e=h-aa;if(!k||E<e)E=e;k=!0}else v=!0}));t+=f.floor||Configuration.visual.curlyHeight;
t>y&&(y=t);B=!0}});c.right=I;f=n.texts.widths[c.text];y+=n.texts.height;var A=-Math.min(w,0);f=Math.max(f,I)-Math.min(0,w);0<H&&(p+=H);h=v?10:W?15:0;var S=p,R=x;if(c.sentence){for(;Q<c.sentence;)Q++,x.arcs=r.group(x.group,{"class":"arcs"}),t.push(x),x=new da(r),u=1-u,x.backgroundIndex=u,x.index=++D;u=1-u}if(c.sentence||p+f+h>=canvasWidth-2*Configuration.visual.margin.x)x.arcs=r.group(x.group,{"class":"arcs"}),p=Configuration.visual.margin.x+20+2+(k?10:W?15:0)+e,k&&(e=n.texts.widths[c.text]+10,e>q&&
(q=e)),0<E&&(p+=E,H=0),t.push(x),r.remove(c.group),x=new da(r),x.backgroundIndex=u,x.index=++D,r.add(x.group,c.group),c.group=x.group.lastElementChild,b(c.group).children("g[class='span']").each(function(d,e){c.fragments[d].group=e}),b(c.group).find("rect[data-span-id]").each(function(d,e){c.fragments[d].rect=e});x.index!==R.index&&b.each(F,function(d,c){c[3]!=S&&O.push([R,c[3],S+A,c[4]]);c[3]=p});b.each(c.markedTextStart,function(d,c){c[3]+=p+A;F[c[0]]=c});b.each(c.markedTextEnd,function(d,c){c[3]+=
p+A;var e=F[c[0]];delete F[c[0]];markedRow=[x,e[3],c[3],e[4]];O.push(markedRow)});B&&(x.hasAnnotations=!0);c.sentence&&(x.sentence=++Q);if(0<H)if(H/=2,e=x.chunks[x.chunks.length-1],e===G)console.log("warning: firstChunkInRow undefined, chunk:",c);else for(Z<e.index&&(Z=e.index+1),e=Z;e<c.index;e++)h=l.chunks[e],va(h,h.translation.x+H,0),h.textX+=H;x.chunks.push(c);c.row=x;va(c,p+A,0);c.textX=p+A;p+=f});x.arcs=r.group(x.group,{"class":"arcs"});t.push(x);Util.profileEnd("chunks");Util.profileStart("arcsPrep");
var Z={};(B=Fa(c,"none"))&&(Z.none=B);d=J.length;for(B=0;B<d;B++)if(!J[B]||J[B]<Configuration.visual.arcStartHeight)J[B]=Configuration.visual.arcStartHeight;b.each(l.arcs,function(d,c){c.jumpHeight=0;var e=l.spans[c.origin].headFragment,b=l.spans[c.target].headFragment;if(e.span.hidden||b.span.hidden)c.hidden=!0;else{if(e.towerId>b.towerId){var f=e;e=b;b=f}for(e.chunk.index==b.chunk.index?(e=e.towerId,b=b.towerId):(e=e.towerId+1,b=b.towerId-1);e<=b;e++)c.jumpHeight<J[2*e]&&(c.jumpHeight=J[2*e])}});
l.arcs.sort(function(c,d){var e=c.jumpHeight-d.jumpHeight;return e||(e=c.dist-d.dist)||(e=l.spans[c.origin].headFragment.height+l.spans[c.target].headFragment.height-l.spans[d.origin].headFragment.height-l.spans[d.target].headFragment.height)?0>e?-1:1:(e=l.spans[c.origin].headFragment.height-l.spans[d.origin].headFragment.height)?0>e?-1:1:0});var N=0,L=0;b.each(t,function(c,d){var e=!1;d.heightsStart=d.heightsEnd=N;b.each(d.chunks,function(c,b){if(b.lastFragmentIndex!==G){e=!0;var f=2*b.lastFragmentIndex+
L;d.heightsEnd<f&&(d.heightsEnd=f);f=2*b.firstFragmentIndex+L;d.heightsStart>f&&(d.heightsStart=f)}});J.splice(d.heightsStart,0,Configuration.visual.arcStartHeight);L++;d.heightsAdjust=L;e&&(d.heightsEnd+=2);N=d.heightsEnd+1});B=r.marker(c,"drag_arrow",5,2.5,5,5,"auto",{markerUnits:"strokeWidth","class":"drag_fill"});r.polyline(B,[[0,0],[5,2.5],[0,5],[.2,2.5]]);B=r.path(r.createPath(),{markerEnd:"url(#drag_arrow)","class":"drag_stroke",fill:"none",visibility:"hidden"});g.post("arcDragArcDrawn",[B]);
Util.profileEnd("arcsPrep");Util.profileStart("arcs");var ka={};b.each(l.arcs,function(d,e){if(!e.hidden){if(e.type)var f=e.type.match(/^(.*?)(\d*)$/),h=f[1];var g=l.spans[e.origin],k=l.spans[e.target],v=g.headFragment.towerId<k.headFragment.towerId;if(v)var q=g.headFragment,B=k.headFragment;else q=k.headFragment,B=g.headFragment;var p=m[e.type]||m[h],w=C[g.type];!p&&w&&w.arcs&&b.each(w.arcs,function(d,c){c.type==e.type&&(p=c)});!p&&h&&h!=e.type&&w&&w.arcs&&b.each(w.arcs,function(d,c){c.type==h&&
(p=c)});p||(p={});w=p&&p.color||C.ARC_DEFAULT&&C.ARC_DEFAULT.color||"#000000";if("hidden"!=w){var u=p&&p.properties&&p.properties.symmetric,W=p&&p.dashArray,x=(p&&p.arrowHead||C.ARC_DEFAULT&&C.ARC_DEFAULT.arrowHead||"triangle,5")+","+w,z=(p&&p.labelArrow||C.ARC_DEFAULT&&C.ARC_DEFAULT.labelArrow||"triangle,5")+","+w,I=fa(q),Q=fa(B),H=q.chunk.row.index,F=B.chunk.row.index;if(!Z[x]){var D=Fa(c,x);D&&(Z[x]=D)}Z[z]||(D=Fa(c,z))&&(Z[z]=D);q.chunk.index==B.chunk.index?(x=2*q.towerId+q.chunk.row.heightsAdjust,
z=2*B.towerId+B.chunk.row.heightsAdjust):(x=2*q.towerId+1+q.chunk.row.heightsAdjust,z=2*B.towerId-1+B.chunk.row.heightsAdjust);if(!S){var y=ta(x,z,J);Ia(x,z,J,y);y+=.5}D=!1;(g=g.headFragment.chunk.index==k.headFragment.chunk.index)&&(D=I.x+I.width/2<Q.x+Q.width/2);k=g?D?-.5:.5:1;for(var E=H;E<=F;E++){var A=t[E];if(A.chunks.length){A.hasAnnotations=!0;if(S){var O=E==H?x:A.heightsStart,R=E==F?z:A.heightsEnd;y=ta(O,R,J)}var ba=r.group(A.arcs,{"data-from":e.origin,"data-to":e.target}),L=E==H?I.x+(D?0:
I.width):20,N=E==F?Q.x+(D?Q.width:0):canvasWidth-2*Configuration.visual.margin.y,X=!0;if(ca){var M=e.type+" "+E+" "+L+" "+N;E==H&&(M=q.span.id+" "+M);E==F&&(M+=" "+B.span.id);var T=ka[M];T!==G?(y=T,X=!1):ka[M]=y}S&&X&&(Ia(O,R,J,y),y+=.5);X=l.spans[e.origin].type;M=Util.getArcLabels(C,X,e.type,m);X=Util.arcDisplayForm(C,X,e.type,m);if(Configuration.abbrevsOn&&M){T=1;for(var U=N-L-15;n.arcs.widths[X]>U&&M[T];)X=M[T],T++}if(e.shadowClass||e.marked)var V=r.group(ba);M={fill:w,"data-arc-role":e.type,"data-arc-origin":e.origin,
"data-arc-target":e.target,"data-arc-ed":e.eventDescId};f[2]?(U=X.match(/^(.*?)(\d*)$/)[1],T=r.createText(),T.span(U,M),U={dy:"0.3em","font-size":"80%"},b.extend(U,M),T.span(f[2],U)):T=X;r.text(ba,(L+N)/2,-y+n.arcs.height/4,T,M);M=n.arcs.widths[X];X=(L+N-M)/2;T=M;M=-y-n.arcs.height/2;U=n.arcs.height;if(e.marked){var Y=r.rect(V,X-2,M-2,T+4,U+4,{"class":"shadow_EditHighlight",rx:2,ry:2});r.other(Y,"animate",{"data-type":e.marked,attributeName:"fill",values:"match"==e.marked?"#FFFF00":"#FF9632;#FFCC00;#FF9632",
dur:"2s",repeatCount:"indefinite",begin:"indefinite"})}e.shadowClass&&r.rect(V,X-1,M-1,T+2,U+2,{"class":"shadow_"+e.shadowClass,filter:"url(#Gaussian_Blur)",rx:5,ry:5});M=X;X+=T;M-=Configuration.visual.arcTextMargin;X+=Configuration.visual.arcTextMargin;L>N&&(T=M,M=X,X=T);y=(y|0)+.5;y>A.maxArcHeight&&(A.maxArcHeight=y);A=p&&p.arrowHead||C.ARC_DEFAULT&&C.ARC_DEFAULT.arrowHead;A=(u?A||"none":v?"none":A||"triangle,5")+","+w;T=(T=Z[A])&&"url(#"+T+")";var K=0;U=null;var P=p&&p.labelArrow||C.ARC_DEFAULT&&
C.ARC_DEFAULT.labelArrow;P&&(U=(v?u&&P||"none":P||"triangle,5")+","+w,K=U.split(","),K="none"!=K[0]&&parseInt(K[1],10)||0,U=(U=Z[U])&&"url(#"+U+")",g&&(K=-K));P=M-K;M=r.createPath().move(P,-y);if(E==H){K=L+15*k;!g&&K>P-1&&(K=P-1);P=g?K+10*k:.5*L+.5*K;var ja=I.y+(v||e.equiv?I.height/2:Configuration.visual.margin.y);2>Math.abs(-y-ja)&&5>Math.abs(K-L)&&(ja=-y);line=M.line(K,-y).curveQ(P,-y,L,ja)}else M.line(L,-y);r.path(ba,M,{markerEnd:T,markerStart:U,style:"stroke: "+w,strokeDashArray:W});e.marked&&
(r.path(V,M,{"class":"shadow_EditHighlight_arc",strokeWidth:7,strokeDashArray:W}),r.other(Y,"animate",{"data-type":e.marked,attributeName:"fill",values:"match"==e.marked?"#FFFF00":"#FF9632;#FFCC00;#FF9632",dur:"2s",repeatCount:"indefinite",begin:"indefinite"}));e.shadowClass&&r.path(V,M,{"class":"shadow_"+e.shadowClass,strokeWidth:2.5,strokeDashArray:W});u||(A=p&&p.arrowHead||C.ARC_DEFAULT&&C.ARC_DEFAULT.arrowHead,A=(v?A||"triangle,5":"none")+","+w);T=(T=Z[A])&&"url(#"+T+")";K=0;U=null;if(P=p&&p.labelArrow||
C.ARC_DEFAULT&&C.ARC_DEFAULT.labelArrow)U=(v?P||"triangle,5":u&&P||"none")+","+w,K=U.split(","),K="none"!=K[0]&&parseInt(K[1],10)||0,U=(U=Z[U])&&"url(#"+U+")",g&&(K=-K);L=X+K;M=r.createPath().move(L,-y);E==F?(K=N-15*k,!g&&K<L+1&&(K=L+1),P=g?K-10*k:.5*N+.5*K,ja=Q.y+(v&&!e.equiv?Configuration.visual.margin.y:Q.height/2),2>Math.abs(-y-ja)&&5>Math.abs(K-N)&&(ja=-y),M.line(K,-y).curveQ(P,-y,N,ja)):M.line(N,-y);r.path(ba,M,{markerEnd:T,markerStart:U,style:"stroke: "+w,strokeDashArray:W});e.marked&&r.path(V,
M,{"class":"shadow_EditHighlight_arc",strokeWidth:7,strokeDashArray:W});V&&r.path(V,M,{"class":"shadow_"+e.shadowClass,strokeWidth:2.5,strokeDashArray:W})}}}}});Util.profileEnd("arcs");Util.profileStart("fragmentConnectors");b.each(l.spans,function(d,c){for(var e=c.fragments.length-1,b=0;b<e;b++){var f=c.fragments[b],h=c.fragments[b+1],m=fa(f),g=fa(h);f=f.chunk.row.index;h=h.chunk.row.index;for(var k=f;k<=h;k++){var l=t[k];if(l.chunks.length){l.hasAnnotations=!0;from=k==f?m.x+m.width:20;to=k==h?g.x:
canvasWidth-2*Configuration.visual.margin.y;var v=m.y+m.height-Configuration.visual.margin.y;v=(v|0)+.5;v=r.createPath().move(from,v).line(to,v);r.path(l.arcs,v,{style:"stroke: #000000",strokeDashArray:"1,3,3,3"})}}}});Util.profileEnd("fragmentConnectors");Util.profileStart("rows");var ea=Configuration.visual.margin.y,Y=r.group({"class":"sentnum"}),ma;b.each(t,function(d,c){b.each(c.chunks,function(d,e){b.each(e.fragments,function(d,e){c.maxSpanHeight<e.height&&(c.maxSpanHeight=e.height)})});c.sentence&&
(ma=c.sentence);var e=Math.max(c.maxArcHeight+5,c.maxSpanHeight+1.5);e=c.hasAnnotations?e+-3.5:e-5;e+=2;r.rect(h,0,ea+n.texts.y+n.texts.height,canvasWidth,e+n.texts.height+1,{"class":l.markedSent[ma]?"backgroundHighlight":"striped"==Configuration.textBackgrounds?"background"+c.backgroundIndex:"background0"});ea+=e;ea+=n.texts.height;c.textY=ea-2;if(c.sentence){e=new URLHash(V,f,{focus:[["sent",c.sentence]]});e=r.link(Y,e.getHash());e=r.text(e,20-Configuration.visual.margin.x,ea-2,""+c.sentence,{"data-sent":c.sentence});
var m=l.sentComment[c.sentence];if(m){var g=e.getBBox();r.remove(e);shadowRect=r.rect(Y,g.x-3,g.y-3,g.width+6,g.height+6,{"class":"shadow_"+m.type,filter:"url(#Gaussian_Blur)",rx:2.5,ry:2.5,"data-sent":c.sentence});e=r.text(Y,20-Configuration.visual.margin.x,ea-2,""+c.sentence,{"data-sent":c.sentence})}}e=ea-2;va(c,0,e|0);ea+=Configuration.visual.margin.y});ea+=Configuration.visual.margin.y;Util.profileEnd("rows");Util.profileStart("chunkFinish");var P,ha=function(c,d){var e=P.fragments[c],b=P.fragments[d],
f=Util.cmp(e.from,b.from);return 0!=f?f:Util.cmp(b.to-b.from,e.to-e.from)},pa=function(c,d){var e=P.fragments[c],b=P.fragments[d],f=Util.cmp(b.to,e.to);return 0!=f?f:Util.cmp(b.to-b.from,e.to-e.from)},oa=null;b.each(l.chunks,function(c,d){P=d;d.sentence&&(oa&&r.text(k,0,0,oa),oa=null);oa||(oa=r.createText());var e=l.chunks[c+1];oa.span(d.text+(e?e.space:""),{x:d.textX,y:d.row.textY,"data-chunk-id":d.index});if(d.fragments.length){e=[];for(var b=d.fragments.length-1;0<=b;b--)e.push(b);e.sort(ha);var f=
[];for(b=0;b<e.length;b++){var h=d.fragments[e[b]];h.nestingHeightLR=0;h.nestingDepthLR=0;for(var m=[],g=0;g<f.length;g++)f[g].to>h.from&&(m.push(f[g]),f[g].nestingHeightLR++);f=m;h.nestingDepthLR=f.length;f.push(h)}e.sort(pa);f=[];for(b=0;b<e.length;b++){h=d.fragments[e[b]];h.nestingHeightRL=0;h.nestingDepthRL=0;m=[];for(g=0;g<f.length;g++)f[g].from<h.to&&(m.push(f[g]),f[g].nestingHeightRL++);f=m;h.nestingDepthRL=f.length;f.push(h)}for(b=0;b<e.length;b++)f=d.fragments[e[b]],f.nestingHeight=f.nestingHeightLR>
f.nestingHeightRL?f.nestingHeightLR:f.nestingHeightRL,f.nestingDepth=f.nestingDepthLR>f.nestingDepthRL?f.nestingDepthLR:f.nestingDepthRL;e.sort(function(c,e){return Util.cmp(d.fragments[e].nestingHeight,d.fragments[c].nestingHeight)});for(b=0;b<d.fragments.length;b++)f=d.fragments[e[b]],m=(h=C[f.span.type])&&h.bgColor||C.SPAN_DEFAULT&&C.SPAN_DEFAULT.bgColor||"#ffffff",f.span.hidden||(g=0,1<f.nestingDepth&&0==f.nestingHeight?g=1:0==f.nestingDepth&&0<f.nestingHeight&&(g=-1),h=2*g,g*=1,m=Util.adjustColorLightness(m,
.8),f.highlightPos={x:d.textX+f.curly.from+g,y:d.row.textY+n.texts.y+h+1,w:f.curly.to-f.curly.from-2*g,h:n.texts.height-2*h-1},r.rect(ba,f.highlightPos.x,f.highlightPos.y,f.highlightPos.w,f.highlightPos.h,{fill:m,rx:3,ry:3}))}});oa&&r.text(k,0,0,oa);b.each(O,function(d,c){var e=r.rect(ba,c[1]-2,c[0].textY-n.fragments.height,c[2]-c[1]+4,n.fragments.height+4,{fill:"yellow"}),b=c[3];r.other(e,"animate",{"data-type":b,attributeName:"fill",values:"match"==b?"#FFFF00":"#FF9632;#FFCC00;#FF9632",dur:"2s",
repeatCount:"indefinite",begin:"indefinite"})});Util.profileEnd("chunkFinish");Util.profileStart("finish");r.path(Y,r.createPath().move(20,0).line(20,ea));d=q+20+2*Configuration.visual.margin.x+1;d>canvasWidth&&(canvasWidth=d);E.width(canvasWidth);E.height(ea);y.height(ea);Util.profileEnd("finish");Util.profileEnd("render");Util.profileReport();la=!1;qa&&(qa=!1,Ga());E.find("animate").each(function(){this.beginElement&&this.beginElement()});g.post("doneRendering",[V,f,v])}}else g.post("doneRendering",
[V,f,v])},Na={unableToReadTextFile:!0,annotationFileNotFound:!0,isDirectoryError:!0},Ha=function(c){Util.profileEnd("invoke getDocument");c&&c.exception?Na[c.exception]?g.post("renderError:"+c.exception,[c]):g.post("unknownError",[c.exception]):(c&&L(c),g.post("startedRendering",[V,f,v]),g.post("spin"),setTimeout(function(){try{Ga(c)}catch(e){la=!1,console.warn("Rendering terminated due to: "+e,e.stack),g.post("renderError: Fatal",[c,e])}g.post("unspin")},0))},ra=function(){r&&(B&&J||O)&&Util.areFontsLoaded()&&
(B=!1,O?(Util.profileClear(),Util.profileStart("before render"),Ha(O)):f.length?(Util.profileClear(),Util.profileStart("before render"),Util.profileStart("invoke getDocument"),g.post("ajax",[{action:"getDocument",collection:V,document:f},"renderData",{collection:V,document:f}])):g.post(0,"renderError:noFileSpecified"))},wa,Ka,ua;y=b(y).hide();t=function(c,d){b.each(d,function(d,e){c.bind(e,function(c){g.post(e,[c],"all")})})};t(y,"mouseover mouseout mousemove mouseup mousedown dragstart dblclick click".split(" "));
t(b(document),["keydown","keypress","touchstart","touchend"]);t(b(p),["resize"]);y.svg({onLoad:function(c){R.svg=r=c;E=b(r._svg);ra()}});var Ca=function(c){b.each(c,function(c,d){if(d){C[d.type]=d;var e=d.children;e&&e.length&&Ca(e)}})},La=function(d){var c={};b.each(d,function(d,e){c[e.type]=e;var b=[],f;for(f in e.values)e.values.hasOwnProperty(f)&&b.push(f);1==b.length&&(e.bool=b[0])});return c},d=function(c){b.each(c,function(c,b){if(b){m[b.type]=b;var e=b.children;e&&e.length&&d(e)}})};Util.loadFonts(N,
g);g.on("collectionChanged",function(){J=!1}).on("collectionLoaded",function(c){c.exception||(D(c),I=La(c.event_attribute_types),Q=La(c.entity_attribute_types),C={},Ca(c.entity_types),Ca(c.event_types),Ca(c.unconfigured_types),m={},d(c.relation_types),d(c.unconfigured_types),b.each(c.relation_types,function(d,c){m[c.type]=c}),c=(c.visual_options||{}).arc_bundle||"none",ca="all"==c,S="none"!=c,g.post("spanAndAttributeTypesLoaded",[C,Q,I,m]),J=!0,ra())}).on("renderData",Ha).on("triggerRender",ra).on("requestRenderData",
function(c){O=c;ra()}).on("isReloadOkay",function(){return!la}).on("resetData",function(){na(F);Ha()}).on("abbrevs",function(c){Configuration.abbrevsOn=c;g.post("configurationChanged")}).on("textBackgrounds",function(c){Configuration.textBackgrounds=c;g.post("configurationChanged")}).on("layoutDensity",function(c){2>c?(Configuration.visual.margin={x:1,y:0},Configuration.visual.boxSpacing=1,Configuration.visual.curlyHeight=1,Configuration.visual.arcSpacing=7,Configuration.visual.arcStartHeight=18):
2<c?(Configuration.visual.margin={x:2,y:1},Configuration.visual.boxSpacing=3,Configuration.visual.curlyHeight=6,Configuration.visual.arcSpacing=12,Configuration.visual.arcStartHeight=23):(Configuration.visual.margin={x:2,y:1},Configuration.visual.boxSpacing=1,Configuration.visual.curlyHeight=4,Configuration.visual.arcSpacing=9,Configuration.visual.arcStartHeight=19);g.post("configurationChanged")}).on("svgWidth",function(c){y.width(c);Configuration.svgWidth!=c&&(Configuration.svgWidth=c,g.post("configurationChanged"))}).on("current",
function(c,d,b,m){V=c;f=d;v=b;m&&(B=!0,ra())}).on("clearSVG",function(){F=l=null;r.clear();y.hide()}).on("mouseover",function(d){var c=b(d.target),f;if(f=c.attr("data-span-id")){var k=l.spans[f];g.post("displaySpanComment",[d,c,f,k.type,k.attributeText,k.text,k.comment&&k.comment.text,k.comment&&k.comment.type,k.normalizations]);var v=(d=C[k.type])&&d.bgColor||C.SPAN_DEFAULT&&C.SPAN_DEFAULT.bgColor||"#ffffff";if(!k.hidden){wa=[];b.each(k.fragments,function(d,c){wa.push(r.rect(ba,c.highlightPos.x,
c.highlightPos.y,c.highlightPos.w,c.highlightPos.h,{fill:v,opacity:.75,rx:3,ry:3}))});if(R.arcDragOrigin)c.parent().addClass("highlight");else{var n={},p={};p[f]=!0;var q=[],B=function(c,d){if(c.equiv){n[c.eventDescId.substr(0,c.eventDescId.indexOf("*",2)+1)]=!0;var e=l.eventDescs[c.eventDescId];b.each(e.leftSpans.concat(e.rightSpans),function(c,d){p[d]=!0})}else p[c.origin]=!0};b.each(k.incoming,function(c,d){B(d,d.origin)});b.each(k.outgoing,function(c,d){B(d,d.target)});var J=[];b.each(n,function(c,
d){J.push('[data-arc-ed^="'+c+'"]')});Ka=E.find(J.join(", ")).parent().add('g[data-from="'+f+'"], g[data-to="'+f+'"]'+J).addClass("highlight");b.each(p,function(c,d){q.push('rect[data-span-id="'+c+'"]')});ua=E.find(q.join(", ")).parent().addClass("highlight")}ka()}}else if(!R.arcDragOrigin&&(f=c.attr("data-arc-role"))){f=c.attr("data-arc-origin");var u=c.attr("data-arc-target"),t=c.attr("data-arc-role"),x=m&&m[t]&&m[t].properties&&m[t].properties.symmetric,y=c.attr("data-arc-ed"),z="",I="";if(y){var Q=
l.eventDescs[y],A=Q.comment;A&&(z=A.text,I=A.type,""==z&&I&&(z=I));Q.relation&&(k=y)}g.post("displayArcComment",[d,c,x,k,f,l.spans[f].type||"",t,u,l.spans[u].type||"",z,I]);Ka=E.find('g[data-from="'+f+'"][data-to="'+u+'"]').addClass("highlight");ua=b(E).find('rect[data-span-id="'+f+'"], rect[data-span-id="'+u+'"]').parent().addClass("highlight")}else(f=c.attr("data-sent"))&&(A=l.sentComment[f])&&g.post("displaySentComment",[d,c,A.text,A.type])}).on("mouseout",function(c){b(c.target).removeClass("badTarget");
g.post("hideComment");wa&&(b.each(wa,function(){r.remove(this)}),wa=G);ua&&(Ka.removeClass("highlight"),ua.removeClass("highlight"),ua=G);ka()})}}(jQuery,window),Util=function(b,p){var G=5E3,q="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" "),k=function(b,g){return 1==b?""+b+" "+g+" ago":""+b+" "+g+"s ago"},n=function(b,g){var f=b[g];return f&&f.labels||[]},u=function(b,g,m,k){b=(b=b[g])&&b.arcs||[];var f=null,l;m&&(l=m.match(/^(.*?)(\d*)$/)[1]);$.each(b,function(b,g){if(g.type==m||g.type==
l)return f=g,!1});f||(f=$.extend({},k[m]||k[l]));return f&&f.labels||[]},Ea={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,
20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgrey:[169,169,169],darkgreen:[0,100,0],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,
191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],grey:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,
240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgrey:[211,211,211],lightgreen:[144,238,144],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,
240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,216],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,
165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[216,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,
192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},A=/rgb\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*\)/,da=/rgb\(\s*([0-9]+(?:\.[0-9]+)?)%\s*,\s*([0-9]+(?:\.[0-9]+)?)%\s*,\s*([0-9]+(?:\.[0-9]+)?)%\s*\)/,
Y=/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/,ca=/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/,N=function(b){var f=b[0]/255,m=b[1]/255;b=b[2]/255;var g=Math.max(f,m,b),k=Math.min(f,m,b),l=(g+k)/2;if(g==k)var n=k=0;else{var p=g-k;k=.5<l?p/(2-g-k):p/(g+k);switch(g){case f:n=(m-b)/p+(m<b?6:0);break;case m:n=(b-f)/p+2;break;case b:n=(f-m)/p+4}n/=6}return[n,k,l]},L=function(b,g,m){0>m&&(m+=1);1<m&&--m;return m<1/6?b+6*(g-b)*m:.5>m?g:m<2/3?b+(g-b)*(2/3-m)*6:b},D=function(b){var f=b[0],m=b[1];b=b[2];
if(0==m)m=b=f=b;else{var g=.5>b?b*(1+m):b+m-b*m,k=2*b-g;m=L(k,g,f+1/3);b=L(k,g,f);f=L(k,g,f-1/3)}return[255*m,255*b,255*f]},g={},t=function(b,g){if(b===g)return!0;var f=typeof b;if(f!=typeof g)return!1;if(b==g)return!0;if(!b&&g||b&&!g||"object"!==f||b.length&&b.length!==g.length)return!1;for(var k in g)if(!(k in b))return!1;for(k in b)if(!(k in g&&t(b[k],g[k])))return!1;return!0},S=/^([^=]+)=(.*)$/,y=/^[0-9]+$/,R=function(b){b=b||[];for(var f=b.length,g=[],k=0;k<f;k++)$.isArray(b[k])?g.push(b[k].join("~")):
console.error("param: Error: received non-array-in-array argument [",k,"]",":",b[k],"(fix caller)");return g},z={},r={},E=!1,l=function(b,g,m,k){var f=new Dispatcher;new Visualizer(f,b,k);m.collection=null;f.post("collectionLoaded",[g]);f.post("requestRenderData",[m]);return f},F=!1,O=!1,V=function(){F||(F=!0,$.each(O,function(b,g){g.post("triggerRender")}),O=null)};return{profileEnable:function(b){b===p&&(b=!0);E=b},profileClear:function(){E&&(z={},r={})},profileStart:function(b){E&&(r[b]=new Date)},
profileEnd:function(b){if(E){var f=new Date-r[b];z[b]||(z[b]=0);z[b]+=f}},profileReport:function(){E&&b.console&&($.each(z,function(b,g){console.log("profile "+b,g)}),console.log("-------"))},formatTimeAgo:function(b){if(-1E3==b)return"never";var f=new Date,g=f.getTime();g=Math.floor((g-b)/1E3);if(!g)return"just now";if(60>g)return k(g,"second");g=Math.floor(g/60);if(60>g)return k(g,"minute");g=Math.floor(g/60);if(24>g)return k(g,"hour");g=Math.floor(g/24);if(7>g)return k(g,"day");if(28>g)return k(Math.floor(g/
7),"week");b=new Date(b);g=b.getDate()+" "+q[b.getMonth()];b.getYear()!=f.getYear()&&(g+=" "+b.getFullYear());return g},realBBox:function(b){var f=b.rect.getBBox(),g=b.chunk.translation;b=b.chunk.row.translation;f.x+=g.x+b.x;f.y+=g.y+b.y;return f},getSpanLabels:n,spanDisplayForm:function(b,g){return n(b,g)[0]||g},getArcLabels:u,arcDisplayForm:function(b,g,k,l){return u(b,g,k,l)[0]||k},escapeQuotes:function(b){return b.replace(/"/g,"&quot;")},escapeHTML:function(b){return b.replace(/&/g,"&amp;").replace(/</g,
"&lt;").replace(/>/g,"&gt;")},escapeHTMLandQuotes:function(b){return b.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},escapeHTMLwithNewlines:function(b){return b.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br/>")},cmp:function(b,g){return b<g?-1:b>g?1:0},rgbToHsl:N,hslToRgb:D,adjustColorLightness:function(b,k){b in g||(g[b]={});if(!(k in g[b])){var f,l=(f=A.exec(b))?[parseInt(f[1]),parseInt(f[2]),parseInt(f[3])]:(f=da.exec(b))?
[2.55*parseFloat(f[1]),2.55*parseFloat(f[2]),2.55*parseFloat(f[3])]:(f=Y.exec(b))?[parseInt(f[1],16),parseInt(f[2],16),parseInt(f[3],16)]:(f=ca.exec(b))?[parseInt(f[1]+f[1],16),parseInt(f[2]+f[2],16),parseInt(f[3]+f[3],16)]:Ea[$.trim(b).toLowerCase()];if(l===p)g[b][k]=b;else{l=N(l);l[2]=0<k?1-(1-l[2])*(1-k):(1+k)*l[2];var n=D(l);l=g[b];f=Math.floor(n[0]).toString(16);var q=Math.floor(n[1]).toString(16);n=Math.floor(n[2]).toString(16);f=2>f.length?"0"+f:f;q=2>q.length?"0"+q:q;n=2>n.length?"0"+n:n;
l[k]="#"+f+q+n}}return g[b][k]},objectToUrlStr:function(b){a=[];$.each(b,function(b,f){a.push(b+"="+encodeURIComponent(f))});return a.join("&")},isEqual:t,paramArray:R,param:function(b){if(!b)return"";var f=[],g;for(g in b)if(b.hasOwnProperty(g)){var k=b[g];k==p?console.error("Error: received argument",g,"with value",k):$.isArray(k)?(k=R(k),f.push(g+"="+k.join(","))):console.error("param: Error: received non-array argument",g,":",k,"(fix caller)")}return f.join("&")},deparam:function(b){b=b.split("&");
var f=b.length;if(!f)return null;for(var g={},k=0;k<f;k++){var l=b[k].match(S);if(!l||3!=l.length)break;for(var n=[],p=l[2].split(","),q=p.length,r=0;r<q;r++){var u=[];if(p[r].length)for(var t=p[r].split("~"),z=t.length,A=0;A<z;A++)t[A].match(y)?u.push(parseInt(t[A],10)):u.push(t[A]);n.push(u)}g[l[1]]=n}return g},embed:l,embedByURL:function(b,g,k,n,p){var f,m,q=function(){if(f&&m){var g=l(b,f,m,n);p&&p(g)}};"string"==typeof b?$.getJSON(g,function(b){f=b;q()}):f=g;$.getJSON(k,function(b){m=b;q()})},
isMac:"MacIntel"==navigator.platform,loadFonts:function(b,g){F?g.post("triggerRender"):O?O.push(g):(O=[g],b=b||[],b={families:[],urls:b},WebFont.load({custom:b,active:V,inactive:V,fontactive:function(b,f){},fontloading:function(b,f){}}),F=!0,G=2,setTimeout(function(){F||(console.error("Timeout in loading fonts"),V())},G))},areFontsLoaded:function(){return F}}}(window);